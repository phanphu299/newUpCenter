var vue=new Vue({el:"#HocVienIndex",data:{title:"Quản Lý Học Viên",messageText:"",color:"",timeout:3e3,snackbar:!1,deleteDialog:!1,dialog:!1,dialogEdit:!1,dialogDiemDanh:!1,dialogNgayHoc:!1,dialogThemLop:!1,dialogImport:!1,alert:!1,alertEdit:!1,alertNgayHoc:!1,isShowDatePicker:!1,isShowDatePicker2:!1,isShowDatePickerBatDau:!1,isShowDatePickerKetThuc:!1,search:"",newItem:{fullName:"",englishName:"",phone:"",facebookAccount:"",parentFullName:"",quanHe:"",lopHoc:[],isAppend:!1,ngaySinh:""},selectedThang:"",selectedNam:"",itemThang:["1","2","3","4","5","6","7","8","9","10","11","12"],itemNam:[(new Date).toISOString().substr(0,4)-2,(new Date).toISOString().substr(0,4)-1,(new Date).toISOString().substr(0,4)-0],itemToDelete:{},itemToEdit:{},itemToDiemDanh:{},itemToNgayHoc:{},itemToThemLop:{},editedIndex:-1,headers:[{text:"Action",align:"left",sortable:!1,value:""},{text:"Họ Tên",value:"fullName",align:"left",sortable:!0},{text:"Lớp Học",value:"",align:"left",sortable:!1},{text:"Ngày Sinh",value:"ngaySinh",align:"left",sortable:!0},{text:"English Name",value:"englishName",align:"left",sortable:!0},{text:"SĐT",value:"phone",align:"left",sortable:!0},{text:"Facebook",value:"facebookAccount",align:"left",sortable:!0},{text:"Họ Tên Phụ Huynh",value:"parentFullName",align:"left",sortable:!0},{text:"Quan Hệ",value:"quanHe",align:"left",sortable:!0},{text:"Ngày Tạo",value:"createdDate",align:"left",sortable:!0},{text:"Người Tạo",value:"createdBy",align:"left",sortable:!0},{text:"Ngày Sửa",value:"updatedDate",align:"left",sortable:!0},{text:"Người Sửa",value:"updatedBy",align:"left",sortable:!0}],khoaHocItems:[],diemDanhItems:[],ngayHocItem:{ngayBatDau:"",ngayKetThuc:""},itemQuanHe:[],itemLopHoc:[],itemDiemDanh:[],itemThemLop:[],itemNgayHoc:[],selectedLopHoc:{},selectedArrayLopHoc:[],soNgayHoc:[]},async beforeCreate(){let e=this;await axios.get("/HocVien/GetHocVienAsync").then(function(t){e.khoaHocItems=t.data}).catch(function(e){console.log(e)}),await axios.get("/category/GetQuanHeAsync").then(function(t){e.itemQuanHe=t.data}).catch(function(e){console.log(e)}),await axios.get("/LopHoc/GetAvailableLopHocAsync").then(function(t){e.itemLopHoc=t.data}).catch(function(e){console.log(e)})},methods:{async onUpdate(e){let t=this;""===e.fullName||""===e.phone?this.alertEdit=!0:await axios({method:"put",url:"/HocVien/UpdateHocVienAsync",data:{HocVienId:e.hocVienId,FullName:e.fullName,EnglishName:e.englishName,Phone:e.phone,FacebookAccount:e.facebookAccount,ParentFullName:e.parentFullName,QuanHeId:e.quanHeId,NgaySinh:e.ngaySinh,LopHocIds:e.lopHocIds}}).then(function(e){"OK"===e.data.status?(Object.assign(t.khoaHocItems[t.editedIndex],e.data.result),t.snackbar=!0,t.messageText="Cập nhật thành công !!!",t.color="success",t.dialogEdit=!1):(t.snackbar=!0,t.messageText=e.data.message,t.color="error",t.dialogEdit=!1)}).catch(function(e){console.log(e),t.snackbar=!0,t.messageText="Cập nhật lỗi: "+e,t.color="error",t.dialogEdit=!1})},async onToggleAppend(e){let t=this;await axios({method:"put",url:"/HocVien/UpdateChenAsync",data:{HocVienId:e}}).then(function(e){"OK"===e.data.status?(t.snackbar=!0,t.messageText="Cập nhật thành công !!!",t.color="success"):(t.snackbar=!0,t.messageText=e.data.message,t.color="error")}).catch(function(e){console.log(e),t.snackbar=!0,t.messageText="Cập nhật lỗi: "+e,t.color="error"})},mappingEditItem(e){if(this.editedIndex=this.khoaHocItems.indexOf(e),this.itemToEdit=Object.assign({},e),""!==this.itemToEdit.ngaySinh){let[e,t,a]=this.itemToEdit.ngaySinh.split("/");this.itemToEdit.ngaySinh=a+"-"+t+"-"+e}},mappingDiemDanhItem(e){this.editedIndex=this.khoaHocItems.indexOf(e),this.itemToDiemDanh=Object.assign({},e);let t=this;axios.get("/LopHoc/GetLopHocByHocVienIdAsync?HocVienId="+e.hocVienId).then(function(e){t.itemDiemDanh=e.data}).catch(function(e){console.log(e)})},mappingThemLopItem(e){this.editedIndex=this.khoaHocItems.indexOf(e),this.itemToThemLop=Object.assign({},e);let t=this;axios.get("/LopHoc/GetGraduatedAndCanceledLopHocAsync").then(function(e){t.itemThemLop=e.data}).catch(function(e){console.log(e)})},mappingNgayHocItem(e){this.editedIndex=this.khoaHocItems.indexOf(e),this.itemToNgayHoc=Object.assign({},e),this.ngayHocItem.ngayBatDau="",this.ngayHocItem.ngayKetThuc="";let t=this;axios.get("/LopHoc/GetLopHocByHocVienIdAsync?HocVienId="+e.hocVienId).then(function(e){t.itemNgayHoc=e.data}).catch(function(e){console.log(e)})},async onThemLop(e){this.dialogThemLop=!1;let t=this;await axios({method:"post",url:"/HocVien/AddHocVienToLopCuAsync",data:{LopHocId:t.selectedArrayLopHoc,HocVienId:e.hocVienId}}).then(function(e){console.log(e),"OK"===e.data.status?(t.snackbar=!0,t.messageText="Thêm mới thành công !!!",t.color="success",t.selectedArrayLopHoc=[]):(t.snackbar=!0,t.messageText=e.data.message,t.color="error")}).catch(function(e){console.log(e),t.snackbar=!0,t.messageText="Thêm mới lỗi: "+e,t.color="error"})},async onThemNgayHoc(e){if(""!==this.ngayHocItem.ngayBatDau&&null!==this.selectedLopHoc){this.dialogNgayHoc=!1;let t=this;await axios({method:"post",url:"/HocVien/CreateUpdateHocVien_ngayHocAsync",data:{LopHocId:t.selectedLopHoc,HocVienId:e.hocVienId,NgayBatDau:t.ngayHocItem.ngayBatDau,NgayKetThuc:t.ngayHocItem.ngayKetThuc}}).then(function(e){console.log(e),"OK"===e.data.status?(t.snackbar=!0,t.messageText="Thêm mới thành công !!!",t.color="success",t.selectedLopHoc=""):(t.snackbar=!0,t.messageText=e.data.message,t.color="error")}).catch(function(e){console.log(e),t.snackbar=!0,t.messageText="Thêm mới lỗi: "+e,t.color="error"})}else this.alertNgayHoc=!0},async onSave(e){if(""===this.newItem.fullName||""===this.newItem.phone)this.alert=!0;else{this.dialog=!1;let e=this;await axios({method:"post",url:"/HocVien/CreateHocVienAsync",data:{FullName:e.newItem.fullName,EnglishName:e.newItem.englishName,Phone:e.newItem.phone,FacebookAccount:e.newItem.facebookAccount,NgaySinh:e.newItem.ngaySinh,ParentFullName:e.newItem.parentFullName,QuanHeId:e.newItem.quanHe,LopHocIds:e.newItem.lopHoc}}).then(function(t){console.log(t),"OK"===t.data.status?(e.khoaHocItems.splice(0,0,t.data.result),e.snackbar=!0,e.messageText="Thêm mới thành công !!!",e.color="success",e.newItem.fullName="",e.newItem.englishName="",e.newItem.phone="",e.newItem.facebookAccount="",e.newItem.ngaySinh="",e.newItem.parentFullName="",e.newItem.quanHe="",e.newItem.lopHoc=[]):(e.snackbar=!0,e.messageText=t.data.message,e.color="error")}).catch(function(t){console.log(t),e.snackbar=!0,e.messageText="Thêm mới lỗi: "+t,e.color="error"})}},async onDelete(e){let t=this;await axios({method:"delete",url:"/HocVien/DeleteHocVienAsync",data:{HocVienId:e.hocVienId}}).then(function(a){"OK"===a.data.status?(t.khoaHocItems.splice(t.khoaHocItems.indexOf(e),1),t.snackbar=!0,t.messageText="Xóa thành công !!!",t.color="success",t.deleteDialog=!1):(t.snackbar=!0,t.messageText=a.data.message,t.color="error")}).catch(function(e){console.log(e),t.snackbar=!0,t.messageText="Xóa lỗi: "+e,t.color="error"})},async GetDiemDanhByHocVien(){let e=this;""!==this.selectedLopHoc&&""!==this.selectedNam&&""!==this.selectedThang&&(await axios.get("/DiemDanh/GetDiemDanhByHocVienAndLopHocAsync?HocVienId="+e.itemToDiemDanh.hocVienId+"&LopHocId="+e.selectedLopHoc+"&month="+e.selectedThang+"&year="+e.selectedNam).then(function(t){e.diemDanhItems=t.data}).catch(function(e){console.log(e)}),await axios.get("/DiemDanh/GetSoNgayHoc?LopHocId="+e.selectedLopHoc+"&month="+e.selectedThang+"&year="+e.selectedNam).then(function(t){e.soNgayHoc=t.data}).catch(function(e){console.log(e)}))},forceFileDownload(e,t){const a=window.URL.createObjectURL(new Blob([e.data])),o=document.createElement("a");o.href=a,o.setAttribute("download",t+".xlsx"),document.body.appendChild(o),o.click()},async onExport(){let e=this;await axios({url:"/HocVien/Export",method:"get",responseType:"blob"}).then(function(t){e.forceFileDownload(t,"DanhSachHocVien")}).catch(function(e){console.log(e)})},async onExportTemplate(){let e=this;await axios({url:"/HocVien/ExportTemplate?LopHocId="+e.selectedLopHoc,method:"get",responseType:"blob"}).then(function(t){e.forceFileDownload(t,"MauImportHocVien")}).catch(function(e){console.log(e)})},async onImport(){let e=this;if(!e.$refs.myFiles.files.length)return e.snackbar=!0,e.messageText="Phải chọn file để import !!!",void(e.color="error");const t=new FileReader;t.readAsDataURL(e.$refs.myFiles.files[0]),t.addEventListener("load",()=>{axios({url:"/HocVien/Import",method:"post",data:{File:t.result,Name:e.$refs.myFiles.files[0].name}}).then(function(t){if("OK"===t.data.status){for(let a=0;a<t.data.result.length;a++)e.khoaHocItems.splice(0,0,t.data.result[a]);e.snackbar=!0,e.messageText=t.data.message,e.color="success",e.dialogImport=!1}else e.snackbar=!0,e.messageText=t.data.message,e.color="error"}).catch(function(t){console.log(t),e.snackbar=!0,e.messageText="Import lỗi: "+t,e.color="error"})})},async GetNgayHocByHocVien(){let e=this;await axios.get("/HocVien/GetHocVien_LopHocByHocVienAsync?HocVienId="+e.itemToNgayHoc.hocVienId+"&LopHocId="+e.selectedLopHoc).then(function(t){if(null!==t.data){e.ngayHocItem=t.data;let[a,o,n]=e.ngayHocItem.ngayBatDau.split("/");if(e.ngayHocItem.ngayBatDau=n+"-"+o+"-"+a,""!==e.ngayHocItem.ngayKetThuc){let[t,a,o]=e.ngayHocItem.ngayKetThuc.split("/");e.ngayHocItem.ngayKetThuc=o+"-"+a+"-"+t}}else this.ngayHocItem.ngayBatDau="",this.ngayHocItem.ngayKetThuc=""}).catch(function(e){console.log(e)})}}});