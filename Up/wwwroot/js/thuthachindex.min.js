var vue=new Vue({el:"#ThuThachIndex",data:{title:"Quản Lý Thử Thách",messageText:"",color:"",timeout:3e3,snackbar:!1,deleteDialog:!1,deleteDialogCauHoi:!1,dialogEdit:!1,dialogCauHoi:!1,dialog:!1,alert:!1,search:"",searchCauHoi:"",newItem:{name:"",soCauHoi:0,thoiGianLamBai:0,minGrade:0,khoaHoc:""},itemToDelete:{},itemToDeleteCauHoi:{},itemToEdit:{},editedIndex:-1,headers:[{text:"Action",align:"left",sortable:!1,value:""},{text:"Tên Thử Thách",value:"name",align:"left",sortable:!1},{text:"Tên Khóa Học",value:"tenKhoaHoc",align:"left",sortable:!1},{text:"Số Câu Hỏi",value:"soCauHoi",align:"left",sortable:!1},{text:"Thời Gian Làm Bài (phút)",value:"thoiGianLamBai",align:"left",sortable:!1},{text:"Số Điểm Cần Đạt",value:"minGrade",align:"left",sortable:!1},{text:"Ngày Tạo",value:"createdDate",align:"left",sortable:!1},{text:"Người Tạo",value:"createdBy",align:"left",sortable:!1},{text:"Ngày Sửa",value:"updatedDate",align:"left",sortable:!1},{text:"Người Sửa",value:"updatedBy",align:"left",sortable:!1}],headersCauHoi:[{text:"Action",align:"left",sortable:!1,value:""},{text:"Tên Câu Hỏi",value:"name",align:"left",sortable:!1}],thuThachItems:[],cauHoiItems:[],itemKhoaHoc:[],message:"",cauHoiSo:1},async beforeCreate(){let a=this;await axios.get("/ThuThach/GetThuThachAsync").then(function(e){a.thuThachItems=e.data}).catch(function(a){console.log(a.response.data.Message)}),await axios.get("/category/GetKhoaHocAsync").then(function(e){a.itemKhoaHoc=e.data}).catch(function(a){console.log(a.response.data.Message)})},methods:{calculateSoCauHoi:a=>[...Array(a).keys()].map(a=>++a),async onUpdate(a){let e=this;""===a.name||""==a.khoaHoc?(this.alert=!0,this.message="Không được bỏ trống"):a.soCauHoi<=0||a.thoiGianLamBai<=0||a.minGrade<=0?(this.alert=!0,this.message="Số câu hỏi, Thời gian làm bài, Số điểm cần đạt phải lớn hơn 0"):isNaN(a.soCauHoi)||isNaN(a.thoiGianLamBai)||isNaN(a.minGrade)?(this.message="Số câu hỏi, Thời gian làm bài, Số điểm cần đạt chỉ được nhập số",this.alert=!0):await axios({method:"put",url:"/ThuThach/UpdateThuThachAsync",data:{ThuThachId:a.thuThachId,Name:a.name,KhoaHocId:a.khoaHocId,SoCauHoi:a.soCauHoi,ThoiGianLamBai:a.thoiGianLamBai,MinGrade:a.minGrade}}).then(function(a){"OK"===a.data.status?(Object.assign(e.thuThachItems[e.editedIndex],a.data.result),e.snackbar=!0,e.messageText="Cập nhật thành công !!!",e.color="success",e.dialogEdit=!1):(e.snackbar=!0,e.messageText=a.data.message,e.color="error",e.dialogEdit=!1)}).catch(function(a){console.log(a.response.data.Message),e.snackbar=!0,e.messageText="Cập nhật lỗi: "+a.response.data.Message,e.color="error",e.dialogEdit=!1})},mappingEditItem(a){this.editedIndex=this.thuThachItems.indexOf(a),this.itemToEdit=Object.assign({},a)},async mappingEditCauHoiItem(a){this.editedIndex=this.thuThachItems.indexOf(a),this.itemToEdit=Object.assign({},a);var e=this;await axios.get("/CauHoi/GetCauHoiByThuThachAsync?thuThachId="+a.thuThachId+"&stt=1").then(function(a){e.cauHoiItems=a.data}).catch(function(a){console.log(a.response.data.Message)})},async onSave(a){if(""===a.name||""==a.khoaHoc)this.alert=!0,this.message="Không được bỏ trống";else if(a.soCauHoi<=0||a.thoiGianLamBai<=0||a.minGrade<=0)this.alert=!0,this.message="Số câu hỏi, Thời gian làm bài, Số điểm cần đạt phải lớn hơn 0";else if(isNaN(a.soCauHoi)||isNaN(a.thoiGianLamBai)||isNaN(a.minGrade))this.message="Số câu hỏi, Thời gian làm bài, Số điểm cần đạt chỉ được nhập số",this.alert=!0;else{this.dialog=!1;let e=this;await axios({method:"post",url:"/ThuThach/CreateThuThachAsync",data:{Name:a.name,KhoaHocId:a.khoaHoc,SoCauHoi:a.soCauHoi,ThoiGianLamBai:a.thoiGianLamBai,MinGrade:a.minGrade}}).then(function(a){console.log(a),"OK"===a.data.status?(e.thuThachItems.splice(0,0,a.data.result),e.snackbar=!0,e.messageText="Thêm mới thành công !!!",e.color="success",e.newItem.name="",e.newItem.khoaHoc="",e.newItem.soCauHoi=0,e.newItem.thoiGianLamBai=0,e.newItem.minGrade=0):(e.snackbar=!0,e.messageText=a.data.message,e.color="error")}).catch(function(a){console.log(a.response.data.Message),e.snackbar=!0,e.messageText="Thêm mới lỗi: "+a.response.data.Message,e.color="error"})}},async changeCauHoiSo(a){var e=this;await axios.get("/CauHoi/GetCauHoiByThuThachAsync?thuThachId="+a.thuThachId+"&stt="+this.cauHoiSo).then(function(a){e.cauHoiItems=a.data}).catch(function(a){console.log(a.response.data.Message)})},async onDelete(a){let e=this;await axios({method:"delete",url:"/ThuThach/DeleteThuThachAsync",data:{ThuThachId:a.thuThachId}}).then(function(t){console.log(t),"OK"===t.data.status?(e.thuThachItems.splice(e.thuThachItems.indexOf(a),1),e.snackbar=!0,e.messageText="Xóa thành công !!!",e.color="success",e.deleteDialog=!1):(e.snackbar=!0,e.messageText=t.data.message,e.color="error")}).catch(function(a){console.log(a.response.data.Message),e.snackbar=!0,e.messageText="Xóa lỗi: "+a.response.data.Message,e.color="error"})},async onDeleteCauHoi(a){let e=this;await axios({method:"delete",url:"/CauHoi/DeleteCauHoiAsync",data:{CauHoiId:a.cauHoiId}}).then(function(t){"OK"===t.data.status?(e.cauHoiItems.splice(e.cauHoiItems.indexOf(a),1),e.snackbar=!0,e.messageText="Xóa thành công !!!",e.color="success",e.deleteDialogCauHoi=!1):(e.snackbar=!0,e.messageText=t.data.message,e.color="error")}).catch(function(a){console.log(a.response.data.Message),e.snackbar=!0,e.messageText="Xóa lỗi: "+a.response.data.Message,e.color="error"})}}});