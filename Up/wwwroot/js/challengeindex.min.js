var intervalTimer,vue=new Vue({el:"#ChallengeIndex",data:{title:"Wellcome to UP Challenges",messageText:"",color:"",timeout:3e3,snackbar:!1,alert:!1,message:"",trigram:"",hocVien:"",thuThachItems:[],selectedThuThach:"",showTrigram:!0,showIntroduce:!1,showExam:!1,showResult:!1,timeLeft:"00:00",endTime:"0",cauHoiItems:[],result:[],e6:1,steps:1,isPass:!1,score:0,resultList:[],dialogResult:!1,lanThi:0,submitLoading:!1},async beforeCreate(){},watch:{steps(e){this.e6>e&&(this.e6=e)}},methods:{nextStep(e){e===this.steps?this.e6=1:this.e6=e+1},async onSubmitTrigram(e){if(""===e)that.snackbar=!0,that.messageText="ID is required",that.color="error";else{this.dialog=!1;let t=this;await axios({method:"post",url:"/Challenge/GetHocVienAsync?trigram="+e,data:{}}).then(function(e){"OK"===e.data.status?(t.hocVien=e.data.result,t.showTrigram=!1,t.showIntroduce=!0,axios.get("/Challenge/GetThuThachHocVienAsync?hocVienId="+t.hocVien.hocVienId).then(function(e){t.thuThachItems=e.data}).catch(function(e){console.log(e.response.data.Message)})):(t.snackbar=!0,t.messageText=e.data.message,t.color="error")}).catch(function(e){console.log(e.response.data.Message),t.snackbar=!0,t.messageText="Lỗi: "+e.response.data.Message,t.color="error"})}},async letStart(){var e=this;this.showIntroduce=!1;let t=60*this.selectedThuThach.thoiGianLamBai;this.steps=this.selectedThuThach.soCauHoi,await axios.get("/Challenge/GetCauHoiAsync?thuThachId="+e.selectedThuThach.thuThachId).then(function(a){e.cauHoiItems=a.data,e.showExam=!0,e.setTime(t)}).catch(function(e){console.log(e.response.data.Message)})},async onTraLoi(e,t){var a=this.result.find(t=>t.cauHoiId==e.cauHoiId&&e.stt);a&&(this.result=this.result.filter(e=>e!==a)),this.result.push({cauHoiId:e.cauHoiId,cauHoi:e.name,stt:e.stt,dapAnId:t.dapAnId,dapAn:t.name})},async onSubmit(){var e=this;this.submitLoading=!0;var t=this.cauHoiItems.map((e,t)=>({cauHoiId:e.cauHoiId,name:e.name,stt:e.stt,dapAn:e.dapAns.find(e=>e.isTrue)}));this.result.forEach(a=>{t.find(e=>e.cauHoiId==a.cauHoiId&&e.stt==a.stt&&e.dapAn.dapAnId==a.dapAnId)&&e.score++}),this.resultList=t.map(t=>{var a=e.result.find(e=>e.cauHoiId==t.cauHoiId&&e.stt==t.stt);let s="";return a&&(s=a.dapAn),{name:t.name,stt:t.stt,dapAnDung:t.dapAn.name,dapAnHocVien:s}}),e.score>=e.selectedThuThach.minGrade&&(e.isPass=!0),await axios({method:"post",url:"/Challenge/LuuKetQuaAsync",data:{HocVienId:e.hocVien.hocVienId,ThuThachId:e.selectedThuThach.thuThachId,LanThi:0,IsPass:e.isPass,Score:e.score}}).then(function(t){e.lanThi=t.data}).catch(function(e){console.log(e)}),await axios({url:"/Challenge/ExportResult",method:"post",responseType:"blob",data:{Results:e.resultList,IsPass:e.isPass,Score:e.score,TenHocVien:e.hocVien.fullName,Trigram:e.trigram,ChallengeName:e.selectedThuThach.name,LanThi:e.lanThi}}).then(function(t){e.forceFileDownloadPdf(t,e.hocVien.fullName),e.submitLoading=!1,e.showExam=!1,e.showResult=!0}).catch(function(e){console.log(e.response.data.Message)})},forceFileDownloadPdf(e,t){const a=window.URL.createObjectURL(new Blob([e.data])),s=document.createElement("a");s.href=a,s.setAttribute("download","challenge_result_"+t+".pdf"),document.body.appendChild(s),s.click()},setTime(e){clearInterval(intervalTimer),this.timer(e)},timer(e){const t=Date.now()+1e3*e;this.displayTimeLeft(e),this.selectedTime=e,this.displayEndTime(t),this.countdown(t)},countdown(e){intervalTimer=setInterval(()=>{const t=Math.round((e-Date.now())/1e3);0===t&&(this.endTime=0,this.onSubmit()),t<0?clearInterval(intervalTimer):this.displayTimeLeft(t)},1e3)},displayTimeLeft(e){const t=Math.floor(e%3600/60),a=e%60;this.timeLeft=`${zeroPadded(t)}:${zeroPadded(a)}`},displayEndTime(e){const t=new Date(e),a=t.getHours(),s=t.getMinutes();this.endTime=`${hourConvert(a)}:${zeroPadded(s)}`}}});function zeroPadded(e){return e<10?`0${e}`:e}function hourConvert(e){return e%12||12}