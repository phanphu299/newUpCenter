var vue=new Vue({el:"#CauHoiIndex",data:{title:"Quản Lý Câu Hỏi",messageText:"",color:"",timeout:3e3,snackbar:!1,deleteDialog:!1,dialogDapAn:!1,dialogImport:!1,dialog:!1,alert:!1,search:"",newItem:{stt:0,name:"",thuThach:"",dapAns:[],dapAnDung:""},itemToDelete:{},itemToEdit:{},editedIndex:-1,headers:[{text:"Action",align:"left",sortable:!1,value:""},{text:"Tên Thử Thách",value:"name",align:"left",sortable:!1},{text:"Câu Hỏi Số",value:"stt",align:"left",sortable:!1},{text:"Tên Câu Hỏi",value:"tenThuThach",align:"left",sortable:!1}],cauHoiItems:[],itemThuThach:[],itemSoDapAn:[{prefix:"a",value:1},{prefix:"b",value:2},{prefix:"c",value:3},{prefix:"d",value:4},{prefix:"e",value:5},{prefix:"f",value:6}],message:"",soDapAn:3,expanded:[],selectedThuThach:""},async beforeCreate(){let e=this;await axios.get("/CauHoi/GetCauHoiAsync").then(function(a){e.cauHoiItems=a.data}).catch(function(e){console.log(e.response.data.Message)}),await axios.get("/ThuThach/GetThuThachAsync").then(function(a){e.itemThuThach=a.data}).catch(function(e){console.log(e.response.data.Message)})},methods:{calculateSoCauHoi:e=>[...Array(e).keys()].map(e=>++e),mappingEditItem(e){this.editedIndex=this.cauHoiItems.indexOf(e),this.itemToEdit=Object.assign({},e)},validateDapAns:e=>void 0===e.find(e=>""==e),formatDapAns:e=>e.dapAns.map((a,t)=>({name:a,isTrue:t===e.dapAnDung-1})),async onSave(e){if(""===e.name||""===e.thuThach||e.stt<=0||""===e.dapAnDung||!this.validateDapAns(e.dapAns))this.alert=!0,this.message="Không được bỏ trống";else{var a=this.formatDapAns(e);let t=this;this.dialog=!1,await axios({method:"post",url:"/CauHoi/CreateCauHoiAsync",data:{Name:e.name,STT:e.stt,ThuThachId:e.thuThach.thuThachId,DapAns:a}}).then(function(e){"OK"===e.data.status?(t.cauHoiItems.splice(0,0,e.data.result),t.snackbar=!0,t.messageText="Thêm mới thành công !!!",t.color="success",t.newItem.name="",t.newItem.thuThach="",t.newItem.dapAnDung="",t.newItem.stt=0,t.newItem.dapAns=[]):(t.snackbar=!0,t.messageText=e.data.message,t.color="error")}).catch(function(e){console.log(e.response.data.Message),t.snackbar=!0,t.messageText="Thêm mới lỗi: "+e.response.data.Message,t.color="error"})}},async onDelete(e){let a=this;await axios({method:"delete",url:"/CauHoi/DeleteCauHoiAsync",data:{CauHoiId:e.cauHoiId}}).then(function(t){"OK"===t.data.status?(a.cauHoiItems.splice(a.cauHoiItems.indexOf(e),1),a.snackbar=!0,a.messageText="Xóa thành công !!!",a.color="success",a.deleteDialog=!1):(a.snackbar=!0,a.messageText=t.data.message,a.color="error")}).catch(function(e){console.log(e.response.data.Message),a.snackbar=!0,a.messageText="Xóa lỗi: "+e.response.data.Message,a.color="error"})},forceFileDownload(e,a){const t=window.URL.createObjectURL(new Blob([e.data])),s=document.createElement("a");s.href=t,s.setAttribute("download",a+".xlsx"),document.body.appendChild(s),s.click()},async onExportTemplate(){let e=this;await axios({url:"/CauHoi/ExportTemplate?ThuThachId="+e.selectedThuThach.thuThachId+"&ThuThachName="+e.selectedThuThach.name+"&SoCauHoi="+e.selectedThuThach.soCauHoi,method:"get",responseType:"blob"}).then(function(a){e.forceFileDownload(a,"MauImportCauHoi")}).catch(function(e){console.log(e.response.data.Message)})},async onImport(){let e=this;if(!e.$refs.myFiles.files.length)return e.snackbar=!0,e.messageText="Phải chọn file để import !!!",void(e.color="error");const a=new FileReader;a.readAsDataURL(e.$refs.myFiles.files[0]),a.addEventListener("load",()=>{axios({url:"/CauHoi/Import",method:"post",data:{File:a.result,Name:e.$refs.myFiles.files[0].name}}).then(function(a){if("OK"===a.data.status){for(let t=0;t<a.data.result.length;t++)e.cauHoiItems.splice(0,0,a.data.result[t]);e.snackbar=!0,e.messageText=a.data.message,e.color="success",e.dialogImport=!1}else e.snackbar=!0,e.messageText=a.data.message,e.color="error"}).catch(function(a){console.log(a.response.data.Message),e.snackbar=!0,e.messageText="Import lỗi: "+a.response.data.Message,e.color="error"})})}}});