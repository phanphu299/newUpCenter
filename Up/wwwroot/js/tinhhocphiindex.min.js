var vue=new Vue({el:"#HocPhiIndex",data:{title:"Tính Học Phí",messageText:"",color:"",timeout:3e3,snackbar:!1,deleteDialog:!1,dialog:!1,selectedLopHoc:"",selectedThang:"",selectedNam:"",itemThang:["1","2","3","4","5","6","7","8","9","10","11","12"],itemKhuyenMai:["5","10","15","20","25","30","35","40","45","50"],itemNam:[(new Date).toISOString().substr(0,4)-2,(new Date).toISOString().substr(0,4)-1,(new Date).toISOString().substr(0,4)-0],itemLopHoc:[],itemSach:[],tongNgayHoc:0,tongNgayDuocNghi:0,tongHocPhi:0,hocPhiMoiNgay:0,hocVienList:[],headers:[{text:"Đã Đóng?",align:"left",sortable:!0},{text:"Tên Học Viên",align:"left",sortable:!0},{text:"Nợ",align:"left",sortable:!0},{text:"Tài Liệu",align:"left",sortable:!0},{text:"Khuyến Mãi",align:"left",sortable:!0},{text:"Học Phí Tháng Này",align:"left",sortable:!0},{text:"Action",align:"left",sortable:!1}]},async beforeCreate(){let e=this;await axios.get("/LopHoc/GetAvailableLopHocAsync").then(function(t){e.itemLopHoc=t.data}).catch(function(e){console.log(e)}),await axios.get("/Category/GetSachAsync").then(function(t){e.itemSach=t.data}).catch(function(e){console.log(e)})},methods:{async onchangeKhuyenMai(e,t){if(t.hocPhiMoi=t.hocPhiFixed-t.hocPhiFixed*e/100,null!==t.lastGiaSach)for(let e=0;e<t.lastGiaSach.length;e++)t.hocPhiMoi=t.hocPhiMoi+t.lastGiaSach[e];t.hocPhiMoi=1e4*Math.ceil(t.hocPhiMoi/1e4)},async onchangeSach(e,t){if(e.length>0){if(null!==t.lastGiaSach)for(let e=0;e<t.lastGiaSach.length;e++)t.hocPhiMoi=t.hocPhiMoi-t.lastGiaSach[e];t.lastGiaSach=e;for(let o=0;o<e.length;o++)t.hocPhiMoi=t.hocPhiMoi+e[o]}else{for(let e=0;e<t.lastGiaSach.length;e++)t.hocPhiMoi=t.hocPhiMoi-t.lastGiaSach[e];t.lastGiaSach=e}},async onTinhTien(){let e=this;""!==this.selectedLopHoc&&""!==this.selectedNam&&""!==this.selectedThang&&(""===this.khuyenMai&&(this.khuyenMai=0),await axios.get("/HocPhi/GetTinhHocPhiAsync?LopHocId="+this.selectedLopHoc+"&Month="+this.selectedThang+"&Year="+this.selectedNam).then(function(t){e.tongNgayHoc=t.data.soNgayHoc,e.tongNgayDuocNghi=t.data.soNgayDuocNghi,e.tongHocPhi=t.data.hocPhi,e.hocVienList=t.data.hocVienList,e.hocPhiMoiNgay=t.data.hocPhiMoiNgay}).catch(function(e){console.log(e)}))},forceFileDownload(e){const t=window.URL.createObjectURL(new Blob([e.data])),o=document.createElement("a");o.href=t,o.setAttribute("download","hocphi_T"+this.selectedThang+"-"+this.selectedNam+".xlsx"),document.body.appendChild(o),o.click()},async onExport(){let e=this;await axios({url:"/HocPhi/Export",method:"put",responseType:"blob",data:{HocVienList:e.hocVienList,LopHocId:e.selectedLopHoc,month:e.selectedThang,year:e.selectedNam}}).then(function(t){e.forceFileDownload(t)}).catch(function(e){console.log(e)})},formatNumber:e=>e.toLocaleString("it-IT",{style:"currency",currency:"VND"}),async onLuu(e){let t=this;isNaN(e.hocPhiMoi)?(this.messageText="Học phí chỉ được nhập số",this.snackbar=!0,this.color="error"):await axios({method:"post",url:"/HocPhi/LuuDoanhThu_HocPhiAsync",data:{LopHocId:this.selectedLopHoc,HocVienId:e.hocVienId,HocPhi:e.hocPhiMoi,month:this.selectedThang,year:this.selectedNam}}).then(function(e){console.log(e),"OK"===e.data.status?(t.snackbar=!0,t.messageText="Lưu Doanh Thu thành công !!!",t.color="success"):(t.snackbar=!0,t.messageText=e.data.message,t.color="error")}).catch(function(e){console.log(e),t.snackbar=!0,t.messageText="Lưu Doanh Thu lỗi: "+e,t.color="error"})},async onNo(e){let t=this;isNaN(e.hocPhiMoi)?(this.messageText="Học phí chỉ được nhập số",this.snackbar=!0,this.color="error"):await axios({method:"post",url:"/HocPhi/LuuNo_HocPhiAsync",data:{LopHocId:this.selectedLopHoc,HocVienId:e.hocVienId,TienNo:e.hocPhiMoi,month:this.selectedThang,year:this.selectedNam}}).then(function(e){console.log(e),"OK"===e.data.status?(t.snackbar=!0,t.messageText="Lưu Nợ thành công !!!",t.color="success"):(t.snackbar=!0,t.messageText=e.data.message,t.color="error")}).catch(function(e){console.log(e),t.snackbar=!0,t.messageText="Lưu Nợ lỗi: "+e,t.color="error"})}}});