var vue = new Vue({ el: "#HocPhiIndex", data: { title: "Tính Học Phí", messageText: "", color: "", timeout: 3e3, snackbar: !1, deleteDialog: !1, dialog: !1, selectedLopHoc: "", selectedThang: "", selectedNam: "", itemThang: ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12"], itemKhuyenMai: ["5", "10", "15", "20", "25", "30", "35", "40", "45", "50", "55", "60", "65", "70", "75", "80", "85", "90", "95", "100"], itemNam: [(new Date).toISOString().substr(0, 4) - 2, (new Date).toISOString().substr(0, 4) - 1, (new Date).toISOString().substr(0, 4) - 0], itemLopHoc: [], itemSach: [], tongNgayHoc: 0, tongNgayDuocNghi: 0, tongHocPhi: 0, hocPhiMoiNgay: 0, hocVienList: [], headers: [{ text: "Đã Đóng?", align: "left", sortable: !0 }, { text: "Tên Học Viên", align: "left", sortable: !0 }, { text: "Nợ", align: "left", sortable: !0 }, { text: "Tài Liệu", align: "left", sortable: !0 }, { text: "Khuyến Mãi", align: "left", sortable: !0 }, { text: "Học Phí Tháng Này", align: "left", sortable: !0 }, { text: "Action", align: "left", sortable: !1 }] }, async beforeCreate() { let e = this; await axios.get("/LopHoc/GetAvailableLopHocAsync").then(function (o) { e.itemLopHoc = o.data }).catch(function (e) { console.log(e) }), await axios.get("/Category/GetSachAsync").then(function (o) { e.itemSach = o.data }).catch(function (e) { console.log(e) }) }, methods: { async onchangeKhuyenMai(e, o) { if (o.hocPhiMoi = o.hocPhiFixed - o.hocPhiFixed * e / 100, null !== o.lastGiaSach) for (let e = 0; e < o.lastGiaSach.length; e++)o.hocPhiMoi = o.hocPhiMoi + o.lastGiaSach[e]; o.hocPhiMoi = 1e4 * Math.ceil(o.hocPhiMoi / 1e4) }, async onchangeSach(e, o) { if (e.length > 0) { if (null !== o.lastGiaSach) for (let e = 0; e < o.lastGiaSach.length; e++)o.hocPhiMoi = o.hocPhiMoi - o.lastGiaSach[e]; o.lastGiaSach = e; for (let t = 0; t < e.length; t++)o.hocPhiMoi = o.hocPhiMoi + e[t] } else { for (let e = 0; e < o.lastGiaSach.length; e++)o.hocPhiMoi = o.hocPhiMoi - o.lastGiaSach[e]; o.lastGiaSach = e } }, async onTinhTien() { let e = this; "" !== this.selectedLopHoc && "" !== this.selectedNam && "" !== this.selectedThang && ("" === this.khuyenMai && (this.khuyenMai = 0), await axios.get("/HocPhi/GetTinhHocPhiAsync?LopHocId=" + this.selectedLopHoc.lopHocId + "&Month=" + this.selectedThang + "&Year=" + this.selectedNam).then(function (o) { e.tongNgayHoc = o.data.soNgayHoc, e.tongNgayDuocNghi = o.data.soNgayDuocNghi, e.tongHocPhi = o.data.hocPhi, e.hocVienList = o.data.hocVienList, e.hocPhiMoiNgay = o.data.hocPhiMoiNgay }).catch(function (e) { console.log(e) })) }, forceFileDownload(e) { const o = window.URL.createObjectURL(new Blob([e.data])), t = document.createElement("a"); t.href = o, t.setAttribute("download", "hocphi_" + this.selectedLopHoc.name + "_T" + this.selectedThang + "-" + this.selectedNam + ".xlsx"), document.body.appendChild(t), t.click() }, async onExport() { let e = this; await axios({ url: "/HocPhi/Export", method: "put", responseType: "blob", data: { HocVienList: e.hocVienList, LopHocId: e.selectedLopHoc.lopHocId, month: e.selectedThang, year: e.selectedNam } }).then(function (o) { e.forceFileDownload(o) }).catch(function (e) { console.log(e) }) }, formatNumber: e => e.toLocaleString("it-IT", { style: "currency", currency: "VND" }), async onLuu(e) { let o = this; isNaN(e.hocPhiMoi) ? (this.messageText = "Học phí chỉ được nhập số", this.snackbar = !0, this.color = "error") : await axios({ method: "post", url: "/HocPhi/LuuDoanhThu_HocPhiAsync", data: { LopHocId: this.selectedLopHoc.lopHocId, HocVienId: e.hocVienId, HocPhi: e.hocPhiMoi, month: this.selectedThang, year: this.selectedNam } }).then(function (t) { console.log(t), "OK" === t.data.status ? (o.snackbar = !0, o.messageText = "Lưu Doanh Thu thành công !!!", o.color = "success", e.daDongHocPhi = !0) : (o.snackbar = !0, o.messageText = t.data.message, o.color = "error") }).catch(function (e) { console.log(e), o.snackbar = !0, o.messageText = "Lưu Doanh Thu lỗi: " + e, o.color = "error" }) }, async onNo(e) { let o = this; isNaN(e.hocPhiMoi) ? (this.messageText = "Học phí chỉ được nhập số", this.snackbar = !0, this.color = "error") : await axios({ method: "post", url: "/HocPhi/LuuNo_HocPhiAsync", data: { LopHocId: this.selectedLopHoc.lopHocId, HocVienId: e.hocVienId, TienNo: e.hocPhiMoi, month: this.selectedThang, year: this.selectedNam } }).then(function (t) { console.log(t), "OK" === t.data.status ? (o.snackbar = !0, o.messageText = "Lưu Nợ thành công !!!", o.color = "success", e.daDongHocPhi = !1) : (o.snackbar = !0, o.messageText = t.data.message, o.color = "error") }).catch(function (e) { console.log(e), o.snackbar = !0, o.messageText = "Lưu Nợ lỗi: " + e, o.color = "error" }) } } });