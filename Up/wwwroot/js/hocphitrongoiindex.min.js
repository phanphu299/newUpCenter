var vue=new Vue({el:"#HocPhiTronGoiIndex",data:{title:"Quản Lý Học Phí Trọn Gói",messageText:"",color:"",timeout:3e3,snackbar:!1,deleteDialog:!1,isShowDatePicker:!1,isShowDatePicker2:!1,isShowDatePicker3:!1,isShowDatePicker4:!1,isShowDatePickerLopHoc:!1,isShowDatePickerLopHoc2:!1,isShowDatePickerLopHoc3:!1,isShowDatePickerLopHoc4:!1,dialog:!1,alert:!1,alertEdit:!1,loadingHocVien:!1,itemsHocVien:[],itemLopHoc:[],searchHocVien:null,rules:[e=>/^[0-9]*$/.test(e)||"Chỉ được nhập số"],mustNumber:e=>!isNaN(e)||"Chỉ được nhập số",alertMessage:"",search:"",newItem:{hocVien:{},hocPhi:0,fromDate:(new Date).toISOString().substr(0,10),toDate:(new Date).toISOString().substr(0,10),lopHoc:{},fromDateLopHoc:(new Date).toISOString().substr(0,10),toDateLopHoc:(new Date).toISOString().substr(0,10),ghiChu:""},itemLopHoc:[],itemToDelete:{},dialogEdit:!1,editedIndex:-1,headers:[{text:"Action",align:"left",sortable:!1,value:""},{text:"Tên",value:"name",align:"left",sortable:!1},{text:"Học Phí",value:"hocPhi",align:"left",sortable:!1},{text:"Hết Hiệu Lực?",value:"isDisabled",align:"left",sortable:!1},{text:"Ghi Chú",value:"ghiChu",align:"left",sortable:!1},{text:"Từ Ngày",value:"fromDate",align:"left",sortable:!1},{text:"Đến Ngày",value:"toDate",align:"left",sortable:!1},{text:"Ngày Tạo",value:"createdDate",align:"left",sortable:!1},{text:"Người Tạo",value:"createdBy",align:"left",sortable:!1},{text:"Ngày Sửa",value:"updatedDate",align:"left",sortable:!1},{text:"Người Sửa",value:"updatedBy",align:"left",sortable:!1}],khoaHocItems:[],itemToEdit:{},arrayLopHoc:[]},async beforeCreate(){let e=this;await axios.get("/hocphi/GetHocPhiTronGoiAsync").then(function(t){e.khoaHocItems=t.data}).catch(function(e){console.log(e.response.data.Message)})},watch:{searchHocVien(e){e&&e!==this.newItem.hocVien&&this.querySelections(e)}},methods:{remove(e){const t=this.newItem.hocVien.indexOf(e);t>=0&&this.newItem.hocVien.splice(t,1)},async onAddLopHoc(){if(""!==this.newItem.lopHoc){let e=!1;this.arrayLopHoc.map(t=>{t.lopHoc.lopHocId===this.newItem.lopHoc.lopHocId&&(e=!0)}),!1===e&&this.arrayLopHoc.push({lopHoc:this.newItem.lopHoc,fromDate:this.newItem.fromDateLopHoc,toDate:this.newItem.toDateLopHoc})}else this.snackbar=!0,this.messageText="Phải chọn lớp học trước khi thêm !!!",this.color="error"},async onAddLopHocEdit(){if(void 0!==this.itemToEdit.lopHoc){let e=!1;this.itemToEdit.lopHocList.map(t=>{t.lopHoc.lopHocId===this.itemToEdit.lopHoc.lopHocId&&(e=!0)}),!1===e&&this.itemToEdit.lopHocList.push({lopHoc:this.itemToEdit.lopHoc,fromDate:this.itemToEdit.fromDateLopHoc,toDate:this.itemToEdit.toDateLopHoc})}else this.snackbar=!0,this.messageText="Phải chọn lớp học trước khi thêm !!!",this.color="error"},async onXoaLopHoc(e){this.arrayLopHoc=this.arrayLopHoc.filter(t=>t.lopHoc.lopHocId!==e.lopHoc.lopHocId)},async onXoaLopHocEdit(e){this.itemToEdit.lopHocList=this.itemToEdit.lopHocList.filter(t=>t.lopHoc.lopHocId!==e.lopHoc.lopHocId)},async onChangeHocVien(){let e=this;e.itemLopHoc=[],e.arrayLopHoc=[],await axios.get("/LopHoc/GetLopHocByHocVienIdAsync?HocVienId="+this.newItem.hocVien.hocVienId).then(function(t){e.itemLopHoc=t.data}).catch(function(e){console.log(e.response.data.Message)})},async querySelections(e){this.loadingHocVien=!0;let t=this;await axios.get("/hocvien/GetHocVienByNameAsync?name="+e).then(function(e){t.itemsHocVien=e.data,t.loadingHocVien=!1}).catch(function(e){console.log(e.response.data.Message)})},formatNumber:e=>e.toLocaleString("it-IT",{style:"currency",currency:"VND"}),async mappingEditItem(e){let t=this;if(this.itemToEdit=Object.assign({},e),this.editedIndex=this.khoaHocItems.indexOf(e),""!==this.itemToEdit.fromDate){let[e,t,o]=this.itemToEdit.fromDate.split("/");this.itemToEdit.fromDate=o+"-"+t+"-"+e}if(""!==this.itemToEdit.toDate){let[e,t,o]=this.itemToEdit.toDate.split("/");this.itemToEdit.toDate=o+"-"+t+"-"+e}this.itemToEdit.fromDateLopHoc=(new Date).toISOString().substr(0,10),this.itemToEdit.toDateLopHoc=(new Date).toISOString().substr(0,10),await axios.get("/LopHoc/GetLopHocByHocVienIdAsync?HocVienId="+this.itemToEdit.hocVienId).then(function(e){t.itemLopHoc=e.data}).catch(function(e){console.log(e.response.data.Message)})},async onUpdate(e){let t=this;await axios({method:"put",url:"/hocphi/UpdateHocPhiTronGoiAsync",data:{HocPhi:e.hocPhi,FromDate:e.fromDate,ToDate:e.toDate,HocPhiTronGoiId:e.hocPhiTronGoiId,LopHocList:e.lopHocList,GhiChu:e.ghiChu}}).then(function(e){"OK"===e.data.status?(t.snackbar=!0,t.messageText="Cập nhật thành công !!!",t.color="success",Object.assign(t.khoaHocItems[t.editedIndex],e.data.result)):(t.snackbar=!0,t.messageText=e.data.message,t.color="error")}).catch(function(e){console.log(e.response.data.Message),t.snackbar=!0,t.messageText="Cập nhật lỗi: "+e.response.data.Message,t.color="error"}),t.dialogEdit=!1},forceFileDownloadPdf(e,t){const o=window.URL.createObjectURL(new Blob([e.data])),a=document.createElement("a");a.href=o,a.setAttribute("download","bienlaitrongoi_"+t+".pdf"),document.body.appendChild(a),a.click()},async onExportBienLai(e){let t=this;await axios({url:"/HocPhi/ExportBienLaiTronGoi",method:"put",responseType:"blob",data:{HocVienId:e.hocVienId,HocPhi:e.hocPhi,FromDate:e.fromDate,ToDate:e.toDate}}).then(function(o){t.forceFileDownloadPdf(o,e.name)}).catch(function(e){console.log(e.response.data.Message)})},async onSave(e){if(0===this.newItem.hocVien.length)this.alertMessage="Phải chọn ít nhất 1 học viên",this.alert=!0;else if(isNaN(this.newItem.hocPhi)||""===this.newItem.hocPhi)this.alertMessage="Chỉ được nhập số",this.alert=!0;else{this.dialog=!1;let e=this;await axios({method:"post",url:"/hocphi/CreateHocPhiTronGoiAsync",data:{HocVienId:e.newItem.hocVien.hocVienId,HocPhi:e.newItem.hocPhi,FromDate:e.newItem.fromDate,ToDate:e.newItem.toDate,LopHocList:e.arrayLopHoc,GhiChu:e.newItem.ghiChu}}).then(function(t){e.alert=!1,"OK"===t.data.status?(axios.get("/hocphi/GetHocPhiTronGoiAsync").then(function(t){e.khoaHocItems=t.data}).catch(function(e){console.log(e.response.data.Message)}),e.snackbar=!0,e.messageText="Thêm mới thành công !!!",e.color="success",e.newItem.hocVien=[],e.newItem.hocPhi=0,e.newItem.fromDate=(new Date).toISOString().substr(0,10),e.newItem.toDate=(new Date).toISOString().substr(0,10),e.arrayLopHoc=[],e.itemLopHoc=[],e.newItem.ghiChu=""):(e.snackbar=!0,e.messageText=t.data.message,e.color="error")}).catch(function(t){console.log(t.response.data.Message),e.snackbar=!0,e.messageText="Thêm mới lỗi: "+t.response.data.Message,e.color="error"})}},async onToggle(e){let t=this;await axios({method:"put",url:"/hocphi/ToggleHocPhiTronGoiAsync",data:{HocPhiTronGoiId:e}}).then(function(e){"OK"===e.data.status?(t.snackbar=!0,t.messageText="Cập nhật thành công !!!",t.color="success"):(t.snackbar=!0,t.messageText=e.data.message,t.color="error")}).catch(function(e){console.log(e.response.data.Message),t.snackbar=!0,t.messageText="Cập nhật lỗi: "+e.response.data.Message,t.color="error"})},async onDelete(e){let t=this;await axios({method:"delete",url:"/hocphi/DeleteHocPhiTronGoiAsync",data:{HocPhiTronGoiId:e.hocPhiTronGoiId}}).then(function(o){"OK"===o.data.status?(t.khoaHocItems.splice(t.khoaHocItems.indexOf(e),1),t.snackbar=!0,t.messageText="Xóa thành công !!!",t.color="success",t.deleteDialog=!1):(t.snackbar=!0,t.messageText=o.data.message,t.color="error")}).catch(function(e){console.log(e.response.data.Message),t.snackbar=!0,t.messageText="Xóa lỗi: "+e.response.data.Message,t.color="error"})}}});