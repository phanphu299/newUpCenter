var vue=new Vue({el:"#LopHocIndex",data:{title:"Quản Lý Lớp Học",messageText:"",color:"",timeout:3e3,snackbar:!1,deleteDialog:!1,dialog:!1,dialogEdit:!1,dialogDiemDanh:!1,alert:!1,alertEdit:!1,isShowDatePicker:!1,isShowDatePicker2:!1,isShowDatePicker3:!1,search:"",searchDiemDanh:"",newItem:{name:"",khoaHoc:"",ngayHoc:"",gioHocFrom:"",gioHocTo:"",sach:[],ngayKhaiGiang:(new Date).toISOString().substr(0,10)},selectedThang:"",selectedNam:"",itemThang:["1","2","3","4","5","6","7","8","9","10","11","12"],itemNam:[(new Date).toISOString().substr(0,4)-2,(new Date).toISOString().substr(0,4)-1,(new Date).toISOString().substr(0,4)-0],itemToDelete:{},itemToDiemDanh:{},itemToEdit:{},editedIndex:-1,headers:[{text:"Action",align:"left",sortable:!1,value:""},{text:"Tên Lớp Học",value:"name",align:"left",sortable:!0},{text:"Khóa Học",value:"khoaHoc",align:"left",sortable:!0},{text:"Ngày Học",value:"ngayHoc",align:"left",sortable:!0},{text:"Giờ Học",value:"gioHoc",align:"left",sortable:!0},{text:"Học Phí",value:"hocPhi",align:"left",sortable:!0},{text:"Hủy Lớp",value:"isCanceled",align:"left",sortable:!0},{text:"Tốt Nghiệp",value:"isGraduated",align:"left",sortable:!0},{text:"Ngày Khai Giảng",value:"ngayKhaiGiang",align:"left",sortable:!0},{text:"Ngày Kết Thúc",value:"ngayKetThuc",align:"left",sortable:!0},{text:"Ngày Tạo",value:"createdDate",align:"left",sortable:!0},{text:"Người Tạo",value:"createdBy",align:"left",sortable:!0},{text:"Ngày Sửa",value:"updatedDate",align:"left",sortable:!0},{text:"Người Sửa",value:"updatedBy",align:"left",sortable:!0}],khoaHocItems:[],itemKhoaHoc:[],itemGioHoc:[],itemNgayHoc:[],itemHocPhi:[],itemSach:[],diemDanhItems:[],soNgayHoc:[]},async beforeCreate(){let e=this;await axios.get("/LopHoc/GetLopHocAsync").then(function(t){e.khoaHocItems=t.data}).catch(function(e){console.log(e)}),await axios.get("/category/GetKhoaHocAsync").then(function(t){e.itemKhoaHoc=t.data}).catch(function(e){console.log(e)}),await axios.get("/category/GetNgayHocAsync").then(function(t){e.itemNgayHoc=t.data}).catch(function(e){console.log(e)}),await axios.get("/category/GetGioHocAsync").then(function(t){e.itemGioHoc=t.data}).catch(function(e){console.log(e)}),await axios.get("/category/GetHocPhiAsync").then(function(t){e.itemHocPhi=t.data}).catch(function(e){console.log(e)}),await axios.get("/category/GetSachAsync").then(function(t){e.itemSach=t.data}).catch(function(e){console.log(e)})},methods:{DisplayGioHoc:function(e){return e.from+" - "+e.to},async onUpdate(e){let t=this;""===e.name||""===e.khoaHocId||""===e.ngayHocId||""===e.gioHocId||""===e.giaoVienId?this.alertEdit=!0:await axios({method:"put",url:"/LopHoc/UpdateLopHocAsync",data:{Name:e.name,LopHocId:e.lopHocId,KhoaHocId:e.khoaHocId,GioHocId:e.gioHocId,NgayHocId:e.ngayHocId,HocPhiId:e.hocPhiId,NgayKhaiGiang:e.ngayKhaiGiang,NgayKetThuc:e.ngayKetThuc,IsCanceled:e.isCanceled,IsGraduated:e.isGraduated,SachIds:e.sachIds}}).then(function(e){"OK"===e.data.status?(Object.assign(t.khoaHocItems[t.editedIndex],e.data.result),t.snackbar=!0,t.messageText="Cập nhật thành công !!!",t.color="success",t.dialogEdit=!1):(t.snackbar=!0,t.messageText=e.data.message,t.color="error",t.dialogEdit=!1)}).catch(function(e){console.log(e),t.snackbar=!0,t.messageText="Cập nhật lỗi: "+e,t.color="error",t.dialogEdit=!1})},async onToggleCanceled(e){let t=this;console.log(e),await axios({method:"put",url:"/LopHoc/UpdateHuyLopAsync",data:{LopHocId:e}}).then(function(e){"OK"===e.data.status?(t.snackbar=!0,t.messageText="Cập nhật thành công !!!",t.color="success"):(t.snackbar=!0,t.messageText=e.data.message,t.color="error")}).catch(function(e){console.log(e),t.snackbar=!0,t.messageText="Cập nhật lỗi: "+e,t.color="error"})},async onToggleGraduated(e){let t=this;console.log(e),await axios({method:"put",url:"/LopHoc/UpdateTotNghiepAsync",data:{LopHocId:e}}).then(function(e){"OK"===e.data.status?(t.snackbar=!0,t.messageText="Cập nhật thành công !!!",t.color="success"):(t.snackbar=!0,t.messageText=e.data.message,t.color="error")}).catch(function(e){console.log(e),t.snackbar=!0,t.messageText="Cập nhật lỗi: "+e,t.color="error"})},mappingEditItem(e){this.editedIndex=this.khoaHocItems.indexOf(e),this.itemToEdit=Object.assign({},e);let[t,a,o]=this.itemToEdit.ngayKhaiGiang.split("/");if(this.itemToEdit.ngayKhaiGiang=o+"-"+a+"-"+t,""!==this.itemToEdit.ngayKetThuc){let[e,t,a]=this.itemToEdit.ngayKetThuc.split("/");this.itemToEdit.ngayKetThuc=a+"-"+t+"-"+e}},mappingDiemDanhItem(e){this.editedIndex=this.khoaHocItems.indexOf(e),this.itemToDiemDanh=Object.assign({},e)},async onTinhDiemDanh(){if(""!==this.selectedNam&&""!==this.selectedThang){let e=this;axios.get("/DiemDanh/GetDiemDanhByLopHocAsync?LopHocId="+e.itemToDiemDanh.lopHocId+"&month="+e.selectedThang+"&year="+e.selectedNam).then(function(t){e.diemDanhItems=t.data}).catch(function(e){console.log(e)}),await axios.get("/DiemDanh/GetSoNgayHoc?LopHocId="+e.itemToDiemDanh.lopHocId+"&month="+e.selectedThang+"&year="+e.selectedNam).then(function(t){e.soNgayHoc=t.data}).catch(function(e){console.log(e)})}},async onSave(e){if(""===this.newItem.name||""===this.newItem.khoaHoc||""===this.newItem.ngayHoc||""===this.newItem.gioHoc||""===this.newItem.giaoVien)this.alert=!0;else{this.dialog=!1;let e=this;await axios({method:"post",url:"/LopHoc/CreateLopHocAsync",data:{Name:e.newItem.name,KhoaHocId:e.newItem.khoaHoc,GioHocId:e.newItem.gioHoc,NgayHocId:e.newItem.ngayHoc,HocPhiId:e.newItem.hocPhi,NgayKhaiGiang:e.newItem.ngayKhaiGiang,SachIds:e.newItem.sach}}).then(function(t){console.log(t),"OK"===t.data.status?(e.khoaHocItems.splice(0,0,t.data.result),e.snackbar=!0,e.messageText="Thêm mới thành công !!!",e.color="success",e.newItem.name="",e.newItem.khoaHoc="",e.newItem.gioHoc="",e.newItem.ngayHoc="",e.newItem.ngayKhaiGiang=(new Date).toISOString().substr(0,10),e.newItem.sach=[]):(e.snackbar=!0,e.messageText=t.data.message,e.color="error")}).catch(function(t){console.log(t),e.snackbar=!0,e.messageText="Thêm mới lỗi: "+t,e.color="error"})}},formatNumber:e=>e.toLocaleString("it-IT",{style:"currency",currency:"VND"}),async onDelete(e){let t=this;await axios({method:"delete",url:"/LopHoc/DeleteLopHocAsync",data:{LopHocId:e.lopHocId}}).then(function(a){"OK"===a.data.status?(t.khoaHocItems.splice(t.khoaHocItems.indexOf(e),1),t.snackbar=!0,t.messageText="Xóa thành công !!!",t.color="success",t.deleteDialog=!1):(t.snackbar=!0,t.messageText=a.data.message,t.color="error")}).catch(function(e){console.log(e),t.snackbar=!0,t.messageText="Xóa lỗi: "+e,t.color="error"})}}});