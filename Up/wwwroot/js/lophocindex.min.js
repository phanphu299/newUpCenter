var vue=new Vue({el:"#LopHocIndex",data:{title:"Quản Lý Lớp Học",messageText:"",color:"",timeout:3e3,snackbar:!1,deleteDialog:!1,dialog:!1,dialogEdit:!1,dialogDiemDanh:!1,alert:!1,alertEdit:!1,isShowDatePicker:!1,isShowDatePicker2:!1,isShowDatePicker3:!1,search:"",searchDiemDanh:"",newItem:{name:"",khoaHoc:"",ngayHoc:"",gioHocFrom:"",gioHocTo:"",ngayKhaiGiang:(new Date).toISOString().substr(0,10)},selectedThang:"",selectedNam:"",itemThang:["1","2","3","4","5","6","7","8","9","10","11","12"],itemNam:[(new Date).toISOString().substr(0,4)-2,(new Date).toISOString().substr(0,4)-1,(new Date).toISOString().substr(0,4)-0],itemToDelete:{},itemToDiemDanh:{},itemToEdit:{},editedIndex:-1,headers:[{text:"Action",align:"left",sortable:!1,value:""},{text:"Tên Lớp Học",value:"name",align:"left",sortable:!0},{text:"Khóa Học",value:"khoaHoc",align:"left",sortable:!0},{text:"Ngày Học",value:"ngayHoc",align:"left",sortable:!0},{text:"Giờ Học",value:"gioHoc",align:"left",sortable:!0},{text:"Hủy Lớp",value:"isCanceled",align:"left",sortable:!0},{text:"Tốt Nghiệp",value:"isGraduated",align:"left",sortable:!0},{text:"Ngày Khai Giảng",value:"ngayKhaiGiang",align:"left",sortable:!0},{text:"Ngày Kết Thúc",value:"ngayKetThuc",align:"left",sortable:!0},{text:"Ngày Tạo",value:"createdDate",align:"left",sortable:!0},{text:"Người Tạo",value:"createdBy",align:"left",sortable:!0},{text:"Ngày Sửa",value:"updatedDate",align:"left",sortable:!0},{text:"Người Sửa",value:"updatedBy",align:"left",sortable:!0}],khoaHocItems:[],itemKhoaHoc:[],itemGioHoc:[],itemNgayHoc:[],diemDanhItems:[],soNgayHoc:[]},async beforeCreate(){let e=this;await axios.get("/LopHoc/GetLopHocAsync").then(function(a){e.khoaHocItems=a.data}).catch(function(e){console.log(e.response.data.Message)}),await axios.get("/category/GetKhoaHocAsync").then(function(a){e.itemKhoaHoc=a.data}).catch(function(e){console.log(e.response.data.Message)}),await axios.get("/category/GetNgayHocAsync").then(function(a){e.itemNgayHoc=a.data}).catch(function(e){console.log(e.response.data.Message)}),await axios.get("/category/GetGioHocAsync").then(function(a){e.itemGioHoc=a.data}).catch(function(e){console.log(e.response.data.Message)})},methods:{DisplayGioHoc:function(e){return e.from+" - "+e.to},async onUpdate(e){let a=this;""===e.name||""===e.khoaHocId||""===e.ngayHocId||""===e.gioHocId||""===e.giaoVienId?this.alertEdit=!0:await axios({method:"put",url:"/LopHoc/UpdateLopHocAsync",data:{Name:e.name,LopHocId:e.lopHocId,KhoaHocId:e.khoaHocId,GioHocId:e.gioHocId,NgayHocId:e.ngayHocId,NgayKhaiGiang:e.ngayKhaiGiang,NgayKetThuc:e.ngayKetThuc,IsCanceled:e.isCanceled,IsGraduated:e.isGraduated}}).then(function(e){"OK"===e.data.status?(Object.assign(a.khoaHocItems[a.editedIndex],e.data.result),a.snackbar=!0,a.messageText="Cập nhật thành công !!!",a.color="success",a.dialogEdit=!1):(a.snackbar=!0,a.messageText=e.data.message,a.color="error",a.dialogEdit=!1)}).catch(function(e){console.log(e.response.data.Message),a.snackbar=!0,a.messageText="Cập nhật lỗi: "+e.response.data.Message,a.color="error",a.dialogEdit=!1})},async onToggleCanceled(e){let a=this;console.log(e),await axios({method:"put",url:"/LopHoc/UpdateHuyLopAsync",data:{LopHocId:e}}).then(function(e){"OK"===e.data.status?(a.snackbar=!0,a.messageText="Cập nhật thành công !!!",a.color="success"):(a.snackbar=!0,a.messageText=e.data.message,a.color="error")}).catch(function(e){console.log(e.response.data.Message),a.snackbar=!0,a.messageText="Cập nhật lỗi: "+e.response.data.Message,a.color="error"})},async onToggleGraduated(e){let a=this;console.log(e),await axios({method:"put",url:"/LopHoc/UpdateTotNghiepAsync",data:{LopHocId:e}}).then(function(e){"OK"===e.data.status?(a.snackbar=!0,a.messageText="Cập nhật thành công !!!",a.color="success"):(a.snackbar=!0,a.messageText=e.data.message,a.color="error")}).catch(function(e){console.log(e.response.data.Message),a.snackbar=!0,a.messageText="Cập nhật lỗi: "+e.response.data.Message,a.color="error"})},mappingEditItem(e){this.editedIndex=this.khoaHocItems.indexOf(e),this.itemToEdit=Object.assign({},e);let[a,t,o]=this.itemToEdit.ngayKhaiGiang.split("/");if(this.itemToEdit.ngayKhaiGiang=o+"-"+t+"-"+a,""!==this.itemToEdit.ngayKetThuc){let[e,a,t]=this.itemToEdit.ngayKetThuc.split("/");this.itemToEdit.ngayKetThuc=t+"-"+a+"-"+e}},mappingDiemDanhItem(e){this.editedIndex=this.khoaHocItems.indexOf(e),this.itemToDiemDanh=Object.assign({},e)},async onTinhDiemDanh(){if(""!==this.selectedNam&&""!==this.selectedThang){let e=this;axios.get("/DiemDanh/GetDiemDanhByLopHocAsync?LopHocId="+e.itemToDiemDanh.lopHocId+"&month="+e.selectedThang+"&year="+e.selectedNam).then(function(a){e.diemDanhItems=a.data}).catch(function(e){console.log(e.response.data.Message)}),await axios.get("/DiemDanh/GetSoNgayHoc?LopHocId="+e.itemToDiemDanh.lopHocId+"&month="+e.selectedThang+"&year="+e.selectedNam).then(function(a){e.soNgayHoc=a.data}).catch(function(e){console.log(e.response.data.Message)})}},async onSave(e){if(""===this.newItem.name||""===this.newItem.khoaHoc||""===this.newItem.ngayHoc||""===this.newItem.gioHoc||""===this.newItem.giaoVien)this.alert=!0;else{this.dialog=!1;let e=this;await axios({method:"post",url:"/LopHoc/CreateLopHocAsync",data:{Name:e.newItem.name,KhoaHocId:e.newItem.khoaHoc,GioHocId:e.newItem.gioHoc,NgayHocId:e.newItem.ngayHoc,NgayKhaiGiang:e.newItem.ngayKhaiGiang}}).then(function(a){console.log(a),"OK"===a.data.status?(e.khoaHocItems.splice(0,0,a.data.result),e.snackbar=!0,e.messageText="Thêm mới thành công !!!",e.color="success",e.newItem.name="",e.newItem.khoaHoc="",e.newItem.gioHoc="",e.newItem.ngayHoc="",e.newItem.ngayKhaiGiang=(new Date).toISOString().substr(0,10)):(e.snackbar=!0,e.messageText=a.data.message,e.color="error")}).catch(function(a){console.log(a.response.data.Message),e.snackbar=!0,e.messageText="Thêm mới lỗi: "+a.response.data.Message,e.color="error"})}},formatNumber:e=>e.toLocaleString("it-IT",{style:"currency",currency:"VND"}),async onDelete(e){let a=this;await axios({method:"delete",url:"/LopHoc/DeleteLopHocAsync",data:{LopHocId:e.lopHocId}}).then(function(t){"OK"===t.data.status?(a.khoaHocItems.splice(a.khoaHocItems.indexOf(e),1),a.snackbar=!0,a.messageText="Xóa thành công !!!",a.color="success",a.deleteDialog=!1):(a.snackbar=!0,a.messageText=t.data.message,a.color="error")}).catch(function(e){console.log(e.response.data.Message),a.snackbar=!0,a.messageText="Xóa lỗi: "+e.response.data.Message,a.color="error"})}}});