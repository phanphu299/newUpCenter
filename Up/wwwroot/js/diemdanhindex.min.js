var vue=new Vue({el:"#DiemDanhIndex",data:{title:"Điểm Danh Học Viên",messageText:"",color:"",timeout:3e3,snackbar:!1,deleteDialog:!1,dialog:!1,selectedLopHoc:"",ngayDiemDanh:(new Date).toISOString().substr(0,10),itemLopHoc:[],isShowDatePicker:!1,search:"",headers:[{text:"Học Viên",value:"fullName",align:"left",sortable:!0},{text:"English Name",value:"englishName",align:"left",sortable:!0},{text:"Có Mặt",align:"left",sortable:!1,value:""},{text:"Vắng",align:"left",sortable:!1,value:""}],diemDanhItems:[],selectedThang:"",selectedNam:"",itemThang:["1","2","3","4","5","6","7","8","9","10","11","12"],itemNam:[(new Date).toISOString().substr(0,4)-2,(new Date).toISOString().substr(0,4)-1,(new Date).toISOString().substr(0,4)-0],soNgayHoc:[]},async beforeCreate(){let e=this;await axios.get("/LopHoc/GetAvailableLopHocAsync").then(function(a){e.itemLopHoc=a.data}).catch(function(e){console.log(e)})},methods:{async onTinhDiemDanh(){let e=this;""!==this.selectedLopHoc&&""!==this.selectedNam&&""!==this.selectedThang&&(axios.get("/DiemDanh/GetDiemDanhByLopHocAsync?LopHocId="+e.selectedLopHoc+"&month="+e.selectedThang+"&year="+e.selectedNam).then(function(a){e.diemDanhItems=a.data;for(let a=0;a<e.diemDanhItems.length;a++)for(let t=0;t<e.diemDanhItems[a].thongKeDiemDanh.length;t++)!0!==e.diemDanhItems[a].thongKeDiemDanh[t].duocNghi&&(e.diemDanhItems[a].thongKeDiemDanh[t].duocNghi=!1)}).catch(function(e){console.log(e)}),await axios.get("/DiemDanh/GetSoNgayHoc?LopHocId="+e.selectedLopHoc+"&month="+e.selectedThang+"&year="+e.selectedNam).then(function(a){e.soNgayHoc=a.data}).catch(function(e){console.log(e)}))},async onDiemDanhNew(e,a,t){let o=this;await axios.get("/DiemDanh/DiemDanhTungHocVienNewAsync?HocVienId="+e+"&LopHocId="+this.selectedLopHoc+"&day="+a+"&month="+this.selectedThang+"&year="+this.selectedNam+"&IsOff="+t).then(function(e){console.log(e),"OK"===e.data.status?(o.snackbar=!0,o.messageText="Điểm danh thành công !!!",o.color="success"):(o.snackbar=!0,o.messageText=e.data.message,o.color="error")}).catch(function(e){console.log(e),o.snackbar=!0,o.messageText="Điểm danh lỗi: "+e,o.color="error"})},async GetHocVienByLopHoc(){let e=this;await axios.get("/DiemDanh/GetHocVienByLopHocAsync?LopHocId="+this.selectedLopHoc).then(function(a){e.hocVienList=a.data}).catch(function(e){console.log(e)})},async DiemDanhCaLop(){let e=this;await axios({method:"post",url:"/DiemDanh/DiemDanhTatCaAsync",data:{LopHocId:this.selectedLopHoc,NgayDiemDanh:this.ngayDiemDanh,IsOff:!1}}).then(function(a){if(console.log(a),"OK"===a.data.status){e.snackbar=!0,e.messageText="Điểm danh thành công !!!",e.color="success";let[a,t,o]=e.ngayDiemDanh.split("-");for(let n of e.diemDanhItems)for(let e of n.thongKeDiemDanh){let[n,s,c]=e.dates.split("-");e.day===parseInt(o)&&a===n&&t===s&&(e.isOff=!0,e.duocNghi=!1)}}else e.snackbar=!0,e.messageText=a.data.message,e.color="error"}).catch(function(a){console.log(a),e.snackbar=!0,e.messageText="Điểm danh lỗi: "+a,e.color="error"})},async LopNghi(){let e=this;await axios({method:"post",url:"/DiemDanh/LopNghiAsync",data:{LopHocId:this.selectedLopHoc,NgayDiemDanh:this.ngayDiemDanh}}).then(function(a){if(console.log(a),"OK"===a.data.status){e.snackbar=!0,e.messageText="Điểm danh thành công !!!",e.color="success";let[a,t,o]=e.ngayDiemDanh.split("-");for(let n of e.diemDanhItems)for(let e of n.thongKeDiemDanh){let[n,s,c]=e.dates.split("-");e.day===parseInt(o)&&a===n&&t===s&&(e.duocNghi=!0)}}else e.snackbar=!0,e.messageText=a.data.message,e.color="error"}).catch(function(a){console.log(a),e.snackbar=!0,e.messageText="Điểm danh lỗi: "+a,e.color="error"})},async UndoLopNghi(){let e=this;await axios({method:"post",url:"/DiemDanh/UndoLopNghiAsync",data:{LopHocId:this.selectedLopHoc,NgayDiemDanh:this.ngayDiemDanh}}).then(function(a){if(console.log(a),"OK"===a.data.status){e.snackbar=!0,e.messageText="Undo thành công !!!",e.color="success";let[a,t,o]=e.ngayDiemDanh.split("-");for(let n of e.diemDanhItems)for(let e of n.thongKeDiemDanh){let[n,s,c]=e.dates.split("-");e.day===parseInt(o)&&a===n&&t===s&&(e.duocNghi=!1,e.isOff=!1)}}else e.snackbar=!0,e.messageText=a.data.message,e.color="error"}).catch(function(a){console.log(a),e.snackbar=!0,e.messageText="Undo lỗi: "+a,e.color="error"})},async onCoMat(e){let a=this;await axios({method:"post",url:"/DiemDanh/DiemDanhTungHocVienAsync",data:{LopHocId:this.selectedLopHoc,NgayDiemDanh:this.ngayDiemDanh,IsOff:!1,HocVienId:e.hocVienId}}).then(function(e){console.log(e),"OK"===e.data.status?(a.snackbar=!0,a.messageText="Điểm danh có mặt thành công !!!",a.color="success"):(a.snackbar=!0,a.messageText=e.data.message,a.color="error")}).catch(function(e){console.log(e),a.snackbar=!0,a.messageText="Điểm danh lỗi: "+e,a.color="error"})},async onVang(e){let a=this;await axios({method:"post",url:"/DiemDanh/DiemDanhTungHocVienAsync",data:{LopHocId:this.selectedLopHoc,NgayDiemDanh:this.ngayDiemDanh,IsOff:!0,HocVienId:e.hocVienId}}).then(function(e){console.log(e),"OK"===e.data.status?(a.snackbar=!0,a.messageText="Điểm danh vắng thành công !!!",a.color="success"):(a.snackbar=!0,a.messageText=e.data.message,a.color="error")}).catch(function(e){console.log(e),a.snackbar=!0,a.messageText="Điểm danh lỗi: "+e,a.color="error"})}}});